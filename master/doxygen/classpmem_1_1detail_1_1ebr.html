<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PMDK C++ bindings: pmem::detail::ebr Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PMDK C++ bindings
   &#160;<span id="projectnumber">1.13.0-rc1</span>
   </div>
   <div id="projectbrief">This is the C++ bindings documentation for PMDK&#39;s libpmemobj.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacepmem.html">pmem</a></li><li class="navelem"><a class="el" href="namespacepmem_1_1detail.html">detail</a></li><li class="navelem"><a class="el" href="classpmem_1_1detail_1_1ebr.html">ebr</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classpmem_1_1detail_1_1ebr-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">pmem::detail::ebr Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Epoch-based reclamation (EBR).  
 <a href="classpmem_1_1detail_1_1ebr.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="ebr_8hpp_source.html">libpmemobj++/detail/ebr.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a6e716fe04ffe2cba2227286985fdf569"><td class="memItemLeft" align="right" valign="top"><a id="a6e716fe04ffe2cba2227286985fdf569"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpmem_1_1detail_1_1ebr.html#a6e716fe04ffe2cba2227286985fdf569">ebr</a> ()</td></tr>
<tr class="memdesc:a6e716fe04ffe2cba2227286985fdf569"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default and only ebr constructor. <br /></td></tr>
<tr class="separator:a6e716fe04ffe2cba2227286985fdf569"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d05a3f5afcad90cded7d2ac1fb6f13c"><td class="memItemLeft" align="right" valign="top">worker&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpmem_1_1detail_1_1ebr.html#a2d05a3f5afcad90cded7d2ac1fb6f13c">register_worker</a> ()</td></tr>
<tr class="memdesc:a2d05a3f5afcad90cded7d2ac1fb6f13c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers and returns a new worker, which can perform critical operations (accessing some shared data that can be removed in other threads).  <a href="classpmem_1_1detail_1_1ebr.html#a2d05a3f5afcad90cded7d2ac1fb6f13c">More...</a><br /></td></tr>
<tr class="separator:a2d05a3f5afcad90cded7d2ac1fb6f13c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a255994eaa514617282b7a794edc913ab"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpmem_1_1detail_1_1ebr.html#a255994eaa514617282b7a794edc913ab">sync</a> ()</td></tr>
<tr class="memdesc:a255994eaa514617282b7a794edc913ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Attempts to synchronise and announce a new epoch.  <a href="classpmem_1_1detail_1_1ebr.html#a255994eaa514617282b7a794edc913ab">More...</a><br /></td></tr>
<tr class="separator:a255994eaa514617282b7a794edc913ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3a9f3961ff55a9ea75700e4a372e981"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpmem_1_1detail_1_1ebr.html#aa3a9f3961ff55a9ea75700e4a372e981">full_sync</a> ()</td></tr>
<tr class="memdesc:aa3a9f3961ff55a9ea75700e4a372e981"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform full synchronisation ensuring that all objects which are no longer globally visible (and potentially staged for reclamation) at the time of calling this routine will be safe to reclaim/destroy after this synchronisation routine completes and returns.  <a href="classpmem_1_1detail_1_1ebr.html#aa3a9f3961ff55a9ea75700e4a372e981">More...</a><br /></td></tr>
<tr class="separator:aa3a9f3961ff55a9ea75700e4a372e981"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c69ecba0ace62ded9c4b6b3171eb65b"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpmem_1_1detail_1_1ebr.html#a3c69ecba0ace62ded9c4b6b3171eb65b">staging_epoch</a> ()</td></tr>
<tr class="memdesc:a3c69ecba0ace62ded9c4b6b3171eb65b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the epoch where objects can be staged for reclamation.  <a href="classpmem_1_1detail_1_1ebr.html#a3c69ecba0ace62ded9c4b6b3171eb65b">More...</a><br /></td></tr>
<tr class="separator:a3c69ecba0ace62ded9c4b6b3171eb65b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aab97a99426cff771cbf931835fea874e"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classpmem_1_1detail_1_1ebr.html#aab97a99426cff771cbf931835fea874e">gc_epoch</a> ()</td></tr>
<tr class="memdesc:aab97a99426cff771cbf931835fea874e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the epoch available for reclamation, i.e.  <a href="classpmem_1_1detail_1_1ebr.html#aab97a99426cff771cbf931835fea874e">More...</a><br /></td></tr>
<tr class="separator:aab97a99426cff771cbf931835fea874e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Epoch-based reclamation (EBR). </p>
<p>Reference:</p>
<p>K. Fraser, Practical lock-freedom, Technical Report UCAM-CL-TR-579, February 2004 <a href="https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-579.pdf">https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-579.pdf</a></p>
<p>Summary:</p>
<p>Any workers (threads or processes) actively referencing (accessing) the globally visible objects must do that in the critical path covered using the dedicated function. The grace period is determined using "epochs" implemented as a global counter (and, for example, a dedicated G/C list for each epoch). Objects in the current global epoch can be staged for reclamation (garbage collection). Then, the objects in the target epoch can be reclaimed after two successful increments of the global epoch. Only three epochs are needed (e, e-1 and e-2), therefore we use clock arithmetics. </p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="aa3a9f3961ff55a9ea75700e4a372e981"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa3a9f3961ff55a9ea75700e4a372e981">&#9670;&nbsp;</a></span>full_sync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pmem::detail::ebr::full_sync </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform full synchronisation ensuring that all objects which are no longer globally visible (and potentially staged for reclamation) at the time of calling this routine will be safe to reclaim/destroy after this synchronisation routine completes and returns. </p>
<p>Note: the synchronisation may take across multiple epochs. </p>

</div>
</div>
<a id="aab97a99426cff771cbf931835fea874e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab97a99426cff771cbf931835fea874e">&#9670;&nbsp;</a></span>gc_epoch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t pmem::detail::ebr::gc_epoch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the epoch available for reclamation, i.e. </p>
<p>the epoch where it is guaranteed that the objects are safe to be reclaimed/destroyed. Note that this function would normally be serialized together with the <a class="el" href="classpmem_1_1detail_1_1ebr.html#a255994eaa514617282b7a794edc913ab" title="Attempts to synchronise and announce a new epoch.">ebr::sync()</a> calls.</p>
<dl class="section return"><dt>Returns</dt><dd>the epoch available for reclamation. </dd></dl>

</div>
</div>
<a id="a2d05a3f5afcad90cded7d2ac1fb6f13c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2d05a3f5afcad90cded7d2ac1fb6f13c">&#9670;&nbsp;</a></span>register_worker()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ebr::worker pmem::detail::ebr::register_worker </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers and returns a new worker, which can perform critical operations (accessing some shared data that can be removed in other threads). </p>
<p>There can be only one worker per thread. The worker will be automatically unregistered in the destructor.</p>
<dl class="exception"><dt>Exceptions</dt><dd>
  <table class="exception">
    <tr><td class="paramname">runtime_error</td><td>if there is already a registered worker for the current thread.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>new registered worker. </dd></dl>

</div>
</div>
<a id="a3c69ecba0ace62ded9c4b6b3171eb65b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c69ecba0ace62ded9c4b6b3171eb65b">&#9670;&nbsp;</a></span>staging_epoch()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t pmem::detail::ebr::staging_epoch </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the epoch where objects can be staged for reclamation. </p>
<p>This can be used as a reference value for the pending queue/tag, used to postpone the reclamation until this epoch becomes available for G/C. Note that this function would normally be serialized together with the <a class="el" href="classpmem_1_1detail_1_1ebr.html#a255994eaa514617282b7a794edc913ab" title="Attempts to synchronise and announce a new epoch.">ebr::sync()</a> calls.</p>
<dl class="section return"><dt>Returns</dt><dd>the epoch where objects can be staged for reclamation. </dd></dl>

</div>
</div>
<a id="a255994eaa514617282b7a794edc913ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a255994eaa514617282b7a794edc913ab">&#9670;&nbsp;</a></span>sync()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool pmem::detail::ebr::sync </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Attempts to synchronise and announce a new epoch. </p>
<p>The synchronisation points must be serialized (e.g. if there are multiple G/C workers or other writers). Generally, calls to <a class="el" href="classpmem_1_1detail_1_1ebr.html#a3c69ecba0ace62ded9c4b6b3171eb65b" title="Returns the epoch where objects can be staged for reclamation.">ebr::staging_epoch()</a> and <a class="el" href="classpmem_1_1detail_1_1ebr.html#aab97a99426cff771cbf931835fea874e" title="Returns the epoch available for reclamation, i.e.">ebr::gc_epoch()</a> would be a part of the same serialized path (calling <a class="el" href="classpmem_1_1detail_1_1ebr.html#a255994eaa514617282b7a794edc913ab" title="Attempts to synchronise and announce a new epoch.">sync()</a> and <a class="el" href="classpmem_1_1detail_1_1ebr.html#aab97a99426cff771cbf931835fea874e" title="Returns the epoch available for reclamation, i.e.">gc_epoch()</a>/staging_epoch() concurrently in two other threads will cause an undefined behavior).</p>
<dl class="section return"><dt>Returns</dt><dd>true if a new epoch is announced and false if it wasn't possible in the current state. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>libpmemobj++/detail/<a class="el" href="ebr_8hpp_source.html">ebr.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
