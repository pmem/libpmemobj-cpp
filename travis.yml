dist: trusty

sudo: required

language: cpp

services:
  - docker

env:
  matrix:
    - TYPE=normal OS=ubuntu OS_VER=18.04 PUSH_IMAGE=1
    - TYPE=normal OS=fedora OS_VER=32 PUSH_IMAGE=1 AUTO_DOC_UPDATE=1
    - TYPE=normal OS=ubuntu OS_VER=18.04 COVERAGE=1
    - TYPE=coverity OS=ubuntu OS_VER=18.04

before_install:
  - echo $TRAVIS_COMMIT_RANGE
  - export HOST_WORKDIR=`pwd`
  - export GITHUB_REPO=pmem/libpmemobj-cpp
  - export DOCKERHUB_REPO=pmem/libpmemobj-cpp
  - cd utils/docker/images
  - ./build-image.sh ${DOCKERHUB_REPO} ${OS}-${OS_VER}
  - cd ..

script:
  - ./build.sh

after_success:
  - images/push-image.sh ${OS}-${OS_VER}
